<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="视图存储过程, 码农耕地人">
    <meta name="description" content="码农耕地人">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>视图存储过程 | 码农耕地人</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="码农耕地人" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>



<!-- 雪花特效 -->


<script type="text/javascript" src="/libs/others/sakura.js"></script>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">码农耕地人</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">码农耕地人</div>
        <div class="logo-desc">
            
            码农耕地人
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">视图存储过程</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255, 0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
        opacity: 0.7;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        /* -    padding-bottom: 30px; */
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/MySQL/">
                                <span class="chip bg-color">MySQL</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/mysql/" class="post-category">
                                mysql
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-09-14
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    1.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    6 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="函数function"><a href="#函数function" class="headerlink" title="函数function"></a>函数function</h1><blockquote>
<p>了解即可 - 开发中肯定用不到.</p>
</blockquote>
<blockquote>
<p>单行函数 - 字符串函数,数字函数,日期函数</p>
<p>多行函数(组函数)</p>
<p>实际上数据库是可以进行编程的.</p>
</blockquote>
<blockquote>
<p>如果使用的是mysql8.x,需要设置一下才能允许自定义函数</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">1. 在my.ini文件下添加：log-bin-trust-function-creators=1 
   需要重启db服务器
   
2. 在mysql客户端[终端] - set global log_bin_trust_function_creators=TRUE;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p><code>函数语法 - 创建</code></p>
<p><code>注意点:</code></p>
<p><code>1. 函数体中肯定有return语句</code></p>
<p><code>2. 只要遇到varchar类型,必须要指定参数的长度</code></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">-- mysql中默认的结束符号使用的是;
-- 修改了默认的结束符号位$$
-- 函数体中肯定会出现分号
delimiter $$

-- 创建函数
create function 函数名([变量 数据类型(长度)]) returns 返回数据类型
begin
    -- 函数体
    return 结果;
end $$

delimiter ;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>删除函数</code></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">-- 删除函数
drop function 函数名;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="练习1-自定义函数"><a href="#练习1-自定义函数" class="headerlink" title="练习1 - 自定义函数"></a>练习1 - 自定义函数</h2><blockquote>
<p>传入俩个整数,返回俩个整数的相加的结果</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop function adds;

delimiter //
create function adds(a int,b int) returns int
begin
    return a + b;
end //
delimiter ;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>调用函数</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">select adds(10,30);
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<h2 id="练习2-自定义函数"><a href="#练习2-自定义函数" class="headerlink" title="练习2 - 自定义函数"></a>练习2 - 自定义函数</h2><blockquote>
<p>日期格式化  xxxx年xx月xx日</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop function my_date;

delimiter //
create function my_date(dt date) returns varchar(20)
begin
    return date_format(dt,'%Y年%m月%d日');
end //
delimiter ;

-- 调用
select my_date(now());

select my_date('2010-09-09');
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h2 id="练习3-while-do…end-while"><a href="#练习3-while-do…end-while" class="headerlink" title="练习3 - while..do…end while"></a>练习3 - while..do…end while</h2><blockquote>
<p><strong>感受循环语句(while .. do. .. end while)以及局部变量(declare)以及变量如何重新设置(set)</strong></p>
<p>1~x之间的总和</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop function x_add;
delimiter //

create function x_add(x int) returns int
begin
    -- 定义俩个局部变量
    declare i int default 1;
    declare sums int default 0;
    -- 循环
    while i<=x do
        -- sums加
        set sums = sums+i;
        -- i自增
        set i = i + 1;
    end while;
    return sums;
end //
delimiter ;

select x_add(100);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h2 id="练习4-if…end-if"><a href="#练习4-if…end-if" class="headerlink" title="练习4 - if…end if"></a>练习4 - if…end if</h2><blockquote>
<p>分支语句</p>
<p>1~x之间的偶数奇数进行相加</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop function ji_add;
delimiter //
create function ji_add(x int) returns int
begin
    declare i int default 1;
    declare sums int default 0;
    while i<=x do
        if i%2!=0 then
        set sums = sums+i;
        end if;
        set i = i + 1;
    end while;
    return sums;
end //
delimiter ;

select ji_add(100);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h2 id="练习4-全局变量"><a href="#练习4-全局变量" class="headerlink" title="练习4 - 全局变量"></a>练习4 - 全局变量</h2><blockquote>
<p>1~x之间的数字之后,但是不包括5的倍数</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop function jis_add;
delimiter //
create function jis_add(x int) returns int
begin
    -- 定义一个局部变量
    declare i int default 1;
    -- 定义一个全局变量 - mysql能够识别到的符号@ - @变量名 - 全局变量
    set @sums = 0;
    -- 类似于java中的continue语句 + 代码块命名
    -- success是一个循环语句标签名称 - 随便命名的
    success:while i<=x do
        if i%5=0 then
            set i = i + 1;
            -- 下面的代码不执行
            -- 继续迭代success的循环 - continue - 继续下一轮循环,忽略本轮的循环
            iterate success;
        end if;
        set @sums = @sums + i;
        set i = i + 1;
    end while;
    return @sums;
end //
delimiter ;

select jis_add(100);
-- 全局变量 - 函数体外部是可以访问得到的
select @sums;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h1 id="存储过程procedure"><a href="#存储过程procedure" class="headerlink" title="存储过程procedure"></a>存储过程procedure</h1><blockquote>
<p>安装好mysql环境之后,实际上就是在本地中安装好了mysql-server - mysql的服务器端以及mysql-client - mysql的客户端</p>
<p>mysql-server - 右击计算机 - 管理 - 服务 - 服务和应用程序 - 右边👉 - Mysql服务</p>
<p>mysql-client - mysql自带的一个客户端.市面上还有很多第三方的客户端[可视化效果不错] - navicat[收费的],idea</p>
</blockquote>
<blockquote>
<p><em><strong>一条sql语句的执行的流程.</strong></em></p>
<p><strong>mysql&gt; select * from s_emp;</strong></p>
<p><em><strong>①当输入sql完毕之后,敲下enter键之后,客户端检测一下sql的语法是否规范.如果不规范,直接报错.</strong></em></p>
<p><em><strong>②如果sql语法是规范的,客户端会负责将这条合法的sql语法发送到mysql-server  - mysql服务器端</strong></em></p>
<p><em><strong>③mysql-server接受到来自于客户端的sql之后.mysql-server会对这条sql进行编译和解析</strong></em></p>
<p><em><strong>④mysql-server会将解析的结果返回给mysql-client端[sql语句的执行结果]</strong></em></p>
<p><em><strong>总结: sql语句 - 语法检测 - 发送到mysql-server - 编译,解析,返回给mysql-client</strong></em>,将这次sql执行的结果保存</p>
</blockquote>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><blockquote>
<p>为了完成一些特定的功能,提前讲sql预编译好,存储在mysql-server端系统的执行计划表中.第一次去调用存储过程的时候</p>
<p>会对sql进行预编译并且进行保存.第二次再调用的时候,省去了sql语句的编译的过程.</p>
<p><strong>存储过程可以做到标准的组件编程[封装sql语句]</strong></p>
</blockquote>
<h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><pre class="line-numbers language-mysql"><code class="language-mysql">-- 删除存储过程
drop procedure 存储过程名;

-- 创建存储过程
delimiter //
create procedure 存储过程名([in|out] [参数列表])
begin
    -- 过程体
end //
delimiter ;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h2><pre class="line-numbers language-mysql"><code class="language-mysql">-- 把s_emp表中的员工的平均薪资的sql预编译好放在mysql-server端
-- select avg(salary) from s_emp;
-- 该条sql经常会被频繁调用/或者该条sql写法比较复杂.
-- 考虑把这条sql封装到 - 存储过程

drop procedure sal_pro;

delimiter //
create procedure sal_pro()
begin
    -- 封装sql语句
    select avg(salary) from s_emp;
end //

delimiter ;

-- 预编译sql语句 - 创建存储过程的时候
-- mysql-server会对这个存储过程中的sql语句进行编译,解析,将sql语句的编译的结果进行保存.
-- 后续的每次调用的过程中.应该不会再对这条sql语句进行编译了.

-- 使用call关键字来调用,不需要编译
-- 第一次调用,
call sal_pro();

-- 第二次调用
-- mysql-server不需要对这个存储过程中的sql语句再去进行编译了[省略了],直接返回之前保存的结果.
call sal_pro();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="输入和输出"><a href="#输入和输出" class="headerlink" title="输入和输出"></a>输入和输出</h2><blockquote>
<ol>
<li>in</li>
<li>out</li>
<li>inout</li>
</ol>
</blockquote>
<h3 id="in输入"><a href="#in输入" class="headerlink" title="in输入"></a>in输入</h3><blockquote>
<p>创建存储过程的时候,参数列表.确认这个参数到底是用来接受参数的,还是用来返回存储过程的结果的.</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure in_pro;
delimiter //
create procedure in_pro(in a int)
begin
    -- System.out.println(a);
    select a;
    -- 对a重新赋值
    set a = 10;
    select a;
end //
delimiter ;

-- 调用
-- 直接传入一个字面量
call in_pro(20);

-- 测试一下使用全局变量进行传参
set @i = 20;
call in_pro(@i);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h3 id="out输出"><a href="#out输出" class="headerlink" title="out输出"></a>out输出</h3><blockquote>
<p>如果参数是使用out来修饰的,它是不能够用来保存接受到的数据的</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure out_pro;
delimiter //
create procedure out_pro(out a int)
begin
    -- a是用out修饰的,所以为null
    select a;
    -- a是out - 存储过程返回出去的数据
    set a = 10;
end //
delimiter ;

-- 报错,如果参数是out修饰的,那么是不能够直接传入一个字面量的
-- call out_pro(100);

-- 如果是out修饰的,调用存储过程,只能传入一个全局变量
set @i=100;
call out_pro(@i);
+------+
| a    |
+------+
| NULL |
+------+
里面的a是没有绑定到你的100 - 原因就是因为a是使用out修饰的.不能接受参数

select @i;
+------+
| @i   |
+------+
|   10 |
+------+
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h2 id="练习-封装单个结果集"><a href="#练习-封装单个结果集" class="headerlink" title="练习 - 封装单个结果集"></a>练习 - 封装单个结果集</h2><blockquote>
<ol>
<li><p>根据员工的id来返回员工的名称,薪资 - sql语句 - 封装</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure emp_pro;
delimiter //
create procedure emp_pro(in eid int(7),out fname varchar(25),out sal float(11,2))
begin
    select first_name into fname from s_emp where id=eid;
    select salary into sal from s_emp where id = eid;
end //
delimiter ;
      
-- 如果参数是out修饰的,必须只能传入全局变量[作用就是来保存存储过程一些执行结果的值]
call emp_pro(1,@fname,@sal);
      
select @fname;
select @sal;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li><p>第二种写法 - 针对的是单个结果集的写法</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure emp_pro;
delimiter //
create procedure emp_pro(in eid int(7),out fname varchar(25),out sal float(11,2))
begin
    select first_name,salary into fname,sal from s_emp where id=eid;
end //
delimiter ;
      
-- 如果参数是out修饰的,必须只能传入全局变量[作用就是来保存存储过程一些执行结果的值]
call emp_pro(1,@fname,@sal);
      
select @fname;
select @sal;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<h2 id="练习-封装的是多行结果集"><a href="#练习-封装的是多行结果集" class="headerlink" title="练习 - 封装的是多行结果集"></a>练习 - 封装的是多行结果集</h2><blockquote>
<p>找出大于某个id的first_name和salary - 结果可能是多行的</p>
<ol>
<li><p>现在已经被弃用的游标 - 性能很低下.</p>
</li>
<li><p><strong>需要定义第三方表来存储我们的多行结果集</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">1. 根据具体的查询的业务来构建第三方表 
   业务中最终查询出来的数据正好都在s_emp表中.
         
   -- 仅仅保留结构,但是不保留结果
   create table s_emp_pro select first_name,salary from s_emp where 1=2;
         
2. 比如分组统计,查询出来的数据不在某个表中存在 - 一定要根据具体的查询出来的数据 - 手动构建一张表
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure emp_pro;
delimiter //
create procedure emp_pro(in eid int(7))
begin
    -- insert into 表名 select 语句;
    insert into s_emp_pro(first_name,salary) select first_name,salary from s_emp where id >= eid;
end //
delimiter ;
      
-- 如果参数是out修饰的,必须只能传入全局变量[作用就是来保存存储过程一些执行结果的值]
call emp_pro(20);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<h2 id="练习-带事务"><a href="#练习-带事务" class="headerlink" title="练习 - 带事务"></a>练习 - 带事务</h2><pre class="line-numbers language-mysql"><code class="language-mysql">-- 转账功能,同时成功,同时失败.
drop procedure transfer_pro;
delimiter //
create procedure transfer_pro(in sid int(7),in tid int(7),in money double(7,2),in st int(7))
begin
    -- 定义一个局部变量 - 展示信息
    declare msg varchar(20) default '0';
    -- 手动开启一个事务
    start transaction;
    update account set balance = balance-money where id = sid;
    -- 模拟一个异常
    if st=1 then
        set msg = 'sorry,转账失败了!';
        rollback;
    else
        update account set balance = balance+money where id = tid;
        -- 手动提交一个事务
        set msg = 'good,转账成功了!';
        commit;
    end if;
    select msg;
end //
delimiter ;

-- st=1,进入到异常块的.
call transfer_pro(1,2,1000.0,1);

-- st=2,正常执行转账的业务功能
call transfer_pro(1,2,1000.0,2);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="语句使用"><a href="#语句使用" class="headerlink" title="语句使用"></a>语句使用</h1><h2 id="条件分支语句"><a href="#条件分支语句" class="headerlink" title="条件分支语句"></a>条件分支语句</h2><blockquote>
<ol>
<li><p>if .. then .. elseif .. then ..elseif.. then … else.. end if;</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure if_pro;
delimiter //
create procedure if_pro(in a int)
begin
    declare msg varchar(20) default '';
    if a>=90 then
        set msg = '优秀';
    elseif a>=80 then
        set msg = '良好';
    else
        set msg = '及格';
    end if;
    select msg;
end //
delimiter ;

call if_pro(85);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>case .. when .. then..else… end case</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure case_pro;
delimiter //
create procedure case_pro(in a int)
begin
    declare msg varchar(20) default '';
    case a
        when 1 then
            set msg='1';
        when 2 then
            set msg = '2';
        else
            set msg = '3';
    end case;
    select msg;
end //
delimiter ;
      
call case_pro(2);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><blockquote>
<ol>
<li><p>while .. do .. end while</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure while_pro;
delimiter //
create procedure while_pro(in x int,out result int)
begin
    declare i int default 1;
    declare sums int default 0;
    while i<=x do
        set sums = sums + i;
        set i = i+1;
    end while;
    -- result修饰成out =return result
    set result = sums;
end //
delimiter ;
      
-- out修饰的,只能传入全局变量
call while_pro(100,@result);
      
select @result;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li><p>loop … end loop</p>
<p>类似于while(true)</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">-- 求1~x结束
drop procedure loop_pro;
delimiter //
create procedure loop_pro(in x int,out result int)
begin
    declare i int default 1;
    set result=0;
    success:loop
        if i>x then
            -- 打破循环
            -- iterate success; -- conintue
            leave success; 
        end if;
        set result = result + i;
        set i = i + 1;
    end loop;
end //
delimiter ;

call loop_pro(100,@result);
select @result;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>repeat .. until .. end repeat</p>
<p>类似于java-&gt; do..while</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop procedure repeat_pro;
delimiter //
create procedure repeat_pro(in x int)
begin
    repeat
        set x = x + 1;
        select x;
    until x>0
    end repeat;
end //
delimiter ;
      
call repeat_pro(-1);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<h1 id="总结函数和存储过程的区别"><a href="#总结函数和存储过程的区别" class="headerlink" title="总结函数和存储过程的区别"></a>总结函数和存储过程的区别</h1><blockquote>
<ol>
<li>定义函数的时候,必须指定returns 返回类型.定义存储过程的时候不需要使用returns 返回类型</li>
<li>函数体中必须要有return语句+返回结果,但是存储过程可以没有return语句</li>
<li>函数的调用用select关键字,存储过程调用使用call关键字</li>
<li>存储过程更加侧重于封装以及预编译sql语句,提高sql语句的复用性.</li>
<li>存储过程中是使用in来接受参数,out来返回结果.</li>
</ol>
</blockquote>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><blockquote>
<p>在mysql中,当我们执行一些操作的时候[比如dml操作 - 触发器能够触发的事件],一旦事件被触发,就会执行一段程序</p>
<p>触发器的本质上就是一个特殊的存储过程</p>
</blockquote>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><blockquote>
<ol>
<li>after触发器 - 在触发条件之后执行</li>
<li>before触发器 - 在触发条件之前执行</li>
</ol>
</blockquote>
<h2 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h2><pre class="line-numbers language-mysql"><code class="language-mysql">-- 删除触发器
drop trigger 触发器名称;
delimiter //
create trigger 触发器名称
触发时机(after,before) 触发事件(insert,delete,update) on 触发器事件所在的表名
for each row
-- 触发器事件程序
begin
    
end //
delimiter ;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="体验-1"><a href="#体验-1" class="headerlink" title="体验"></a>体验</h2><blockquote>
<ol>
<li><p>删除account表中的任意一条数据的时候[触发事件],并且把这条数据放入到备份表中acc_copy</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">-- 创建备份表
create table acc_copy select * from account where 1=2;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop trigger acc_tri;
delimiter //
create trigger acc_tri
after delete on account
for each row
begin
    -- old.列名 - 刚刚删除的那条数据
    insert into acc_copy values(old.id,old.name,old.balance);
end //
delimiter ;

-- 触发器是遇到触发的事件才会执行的.不是我们手动去调用的.
delete from account where id=1;


mysql> select * from account;
   +----+------+----------+
   | id | name | balance  |
   +----+------+----------+
   |  2 | tom  | 10000.00 |
   |  3 | jack |  9000.00 |
   |  4 | ss   |  9000.00 |
   |  5 | ss2  |  9000.00 |
   +----+------+----------+
   4 rows in set (0.00 sec)

   mysql> select * from acc_copy;
   +----+-------+---------+
   | id | name  | balance |
   +----+-------+---------+
   |  1 | admin | 8000.00 |
   +----+-------+---------+
   1 row in set (0.00 sec)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>如果表和表之间存在约束关系,比如1:N,无论是在drop或者delete的时候.必须要先删除多的一方,然后再删除一的一方</p>
<p>必须先把一的一方的所有子记录全部删除完毕,才能删除一的一方</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">drop table tri_cus;
drop table tri_ord;

create table tri_cus(
    id int(7) primary key,
  name varchar(20)
);
insert into tri_cus values(1,'admin');
insert into tri_cus values(2,'tom');

create table tri_ord(
    id int(7) primary key,
  ord_no varchar(20),
  cus_id int(7),
  foreign key(cus_id) references tri_cus(id)
);
insert into tri_ord values(1,'1001',1);
insert into tri_ord values(2,'1002',1);
insert into tri_ord values(3,'1003',2);

-- 外键约束存在的原因
mysql> delete from tri_cus where id=1;
ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`j03s`.`tri_ord`, CONSTRAINT `tri_ord_ibfk_1` FOREIGN KEY (`cus_id`) REFERENCES `tri_cus` (`id`))


-- 删除客户之前,应该先删除订单
drop trigger cus_tri;
delimiter //
create trigger cus_tri
before delete on tri_cus
for each row
begin
    -- 先去删除这个客户的子记录
    delete from tri_ord where cus_id=old.id;
end //
delimiter ;

mysql> delete from tri_cus where id=1;

mysql> select * from tri_cus;
+----+------+
| id | name |
+----+------+
|  2 | tom  |
+----+------+
1 row in set (0.00 sec)

mysql> select * from tri_ord;
+----+--------+--------+
| id | ord_no | cus_id |
+----+--------+--------+
|  3 | 1003   |      2 |
+----+--------+--------+
1 row in set (0.00 sec)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li><p>oracle数据库中还会多一个自检约束[自定义检测],check约束</p>
<p>但是Mysql中是不存在check约束.</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">-- oracle - 使用check约束
create table ckt(
    id int(7) primary key,
  age int(1) check(age>0 and age<100)
)
-- 插入数据的时候,age插入的值只能在check约束自定义的规则之内,否则插入失败.

-- 面试题 - mysql中如何实现oracle数据库中的check自检约束的功能.
-- 在执行insert的时候,对某些数据进行进一步的校验 - 触发器
create table ckt(
    id int(7) primary key,
  age int(1)
);

drop trigger ckt_tri;
delimiter //
create trigger ckt_tri
before insert on ckt
for each row
begin
    -- 对新插入的数据进行一个校验
    -- old.列还是使用new.old列 - 看该列在表中有没有.
    if new.age<18 then
        signal sqlstate 'HY000' set message_text='age不合法';
    end if;
end //
delimiter ;

insert into ckt values(1,20);

insert into ckt values(2,17);
mysql> insert into ckt values(2,17);
ERROR 1644 (HY000): age不合法
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</blockquote>
<h1 id="数据库优化"><a href="#数据库优化" class="headerlink" title="数据库优化"></a>数据库优化</h1><ul>
<li><p>分表/分库</p>
</li>
<li><p>主从复制</p>
</li>
<li><p><em><strong>sql优化操作</strong></em></p>
<ul>
<li><p>select查询列不要出现 *</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">尽量还是select 具体的列名称,
select * 效率低于select 具体的列 - "争议"

为了数据的安全.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>不鼓励使用order by语句</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">mysql中的order by性能是及其低下,业务中如果遇到排序.
建议是先把数据取出来放入到java内存中 - 集合中.

再通过java代码的集合排序的各种方式来进行对数据的排序.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询唯一的非索引列的值的时候,配合limit 1语句,避免全表扫描.</p>
</li>
<li><p>索引优化</p>
</li>
</ul>
</li>
</ul>
<h2 id="sql优化-至少背10条"><a href="#sql优化-至少背10条" class="headerlink" title="sql优化 - 至少背10条"></a>sql优化 - 至少背10条</h2><ol>
<li><p>MySQL如何执行区分大小写的字符串比较？</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">select * from s_emp where binary first_name = 'Carmen';
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则将引擎进行全表扫描。</p>
</li>
<li><p>对查询进行优化，应尽量避免全表扫描，首先应考虑在where及order by涉及的列上建立索引。</p>
</li>
<li><p>应尽量避免在where子句中对字段进行not null值判断，否则将导致引擎放弃使用索引而进行全表扫描</p>
</li>
<li><p>尽量避免在where子句中使用or来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
</li>
</ol>
<p>​    select id from t where num=10 or num=20<br>​    可以这样查询：<br>​    <em>sel</em>ect id from t where num=10<br>​    <em>union</em><br>​    select id from t where num=20</p>
<ol start="6">
<li><p>下面的查询也将导致全表扫描：(不能前置百分号)</p>
<p>select id from t where name like ‘c%’;//走索引.</p>
</li>
<li><p>not in也要慎用，否则会导致全表扫描，如：</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">对于连续的数值，能用between就不要用in了：
select id from t where num between 1 and 3
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>尽量避免在where子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：<br>select id from t where num/2=100</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">    应改为:
 select id from t where num=100*2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
</li>
<li><p>不要在where子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p>
</li>
<li><p>在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</p>
<ul>
<li>遵循最左原则.</li>
</ul>
</li>
<li><p>很多时候用exists代替in[查询性能很低]是一个好的选择：</p>
</li>
</ol>
<p>​        select num from a where num in(select num from b)<br>​         用下面的语句替换：<br>​         <em><strong>select num from a where exists(select 1 from b where num=a.num)</strong></em></p>
<ol start="14">
<li><p>并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用 - 索引有效 - 数据控制30%;</p>
</li>
<li><p>索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert及update的效率，因为insert或update时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。<em><strong>一个表的索引数最好不要超过6个</strong></em>，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。</p>
</li>
<li><p>应尽可能的避免更新 clustered [聚簇]索引数据列，因为clustered索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新clustered索引数据列，那么需要考虑是否应将该索引建为clustered索引。</p>
</li>
<li><p>尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。</p>
</li>
<li><p>尽可能的使用<strong>varchar</strong>/nvarchar代替<strong>char</strong>/nchar，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p>
</li>
<li><p>任何地方都不要使用select * from t，用具体的字段列表代替“*”，不要返回用不到的任何字段。</p>
</li>
<li><p>避免频繁创建和删除临时表，以减少系统表资源的消耗。</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">临时表和表变量 - 推荐表变量来代替临时表的用法.
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。</p>
</li>
<li><p>在新建临时表时，如果一次性插入数据量很大，那么可以使用select into代替create table，避免造成大量log，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。</p>
</li>
<li><p>如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先truncate table，然后drop table，这样可以避免系统表的较长时间锁定。</p>
</li>
<li><p>尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</p>
</li>
<li><p>尽量避免大事务操作，提高系统并发能力。</p>
</li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">码农耕地人</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2021/09/14/%E8%A7%86%E5%9B%BE%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">http://example.com/2021/09/14/%E8%A7%86%E5%9B%BE%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">码农耕地人</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/MySQL/">
                                    <span class="chip bg-color">MySQL</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/09/14/%E8%A7%86%E5%9B%BE%E5%92%8Climit/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/9.jpg" class="responsive-img" alt="视图和limit">
                        
                        <span class="card-title">视图和limit</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-09-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/mysql/" class="post-category">
                                    mysql
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/MySQL/">
                        <span class="chip bg-color">MySQL</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/09/14/B-%E6%A0%91/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="B+树">
                        
                        <span class="card-title">B+树</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-09-14
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/mysql/" class="post-category">
                                    mysql
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/MySQL/">
                        <span class="chip bg-color">MySQL</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录
            </div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

    <div id="floating-toc-btn" class="hide-on-med-and-down">
        <a class="btn-floating btn-large bg-color">
            <i class="fas fa-list-ul"></i>
        </a>
    </div>
    

        <script src="/libs/tocbot/tocbot.min.js"></script>
        <script>
            $(function () {
                tocbot.init({
                    tocSelector: '#toc-content',
                    contentSelector: '#articleContent',
                    headingsOffset: -($(window).height() * 0.4 - 45),
                    collapseDepth: Number('0'),
                    headingSelector: 'h2, h3, h4'
                });

                // modify the toc link href to support Chinese.
                let i = 0;
                let tocHeading = 'toc-heading-';
                $('#toc-content a').each(function () {
                    $(this).attr('href', '#' + tocHeading + (++i));
                });

                // modify the heading title id to support Chinese.
                i = 0;
                $('#articleContent').children('h2, h3, h4').each(function () {
                    $(this).attr('id', tocHeading + (++i));
                });

                // Set scroll toc fixed.
                let tocHeight = parseInt($(window).height() * 0.4 - 64);
                let $tocWidget = $('.toc-widget');
                $(window).scroll(function () {
                    let scroll = $(window).scrollTop();
                    /* add post toc fixed. */
                    if (scroll > tocHeight) {
                        $tocWidget.addClass('toc-fixed');
                    } else {
                        $tocWidget.removeClass('toc-fixed');
                    }
                });

        
                    /* 修复文章卡片 div 的宽度. */
                    let fixPostCardWidth = function (srcId, targetId) {
                        let srcDiv = $('#' + srcId);
                        if (srcDiv.length === 0) {
                            return;
                        }

                        let w = srcDiv.width();
                        if (w >= 450) {
                            w = w + 21;
                        } else if (w >= 350 && w < 450) {
                            w = w + 18;
                        } else if (w >= 300 && w < 350) {
                            w = w + 16;
                        } else {
                            w = w + 14;
                        }
                        $('#' + targetId).width(w);
                    };

                    // 切换TOC目录展开收缩的相关操作.
                    const expandedClass = 'expanded';
                    let $tocAside = $('#toc-aside');
                    let $mainContent = $('#main-content');
                    $('#floating-toc-btn .btn-floating').click(function () {
                        if ($tocAside.hasClass(expandedClass)) {
                            $tocAside.removeClass(expandedClass).hide();
                            $mainContent.removeClass('l9');
                        } else {
                            $tocAside.addClass(expandedClass).show();
                            $mainContent.addClass('l9');
                        }
                        fixPostCardWidth('artDetail', 'prenext-posts');
                    });
        
    });
        </script>
    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">码农耕地人</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">337.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/zhugefeng/zhugefeng.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:156035828@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=156035828" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 156035828" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/xxx" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/xxx" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"left"},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>

</html>
